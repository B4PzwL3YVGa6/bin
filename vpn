#!/bin/dash
#
# http://github.com/mitchweaver/bin
#
# openvpn wrapper for ease of use 
#

[ $(id -u) -ne 0 ] && 
    { doas $0 "$@" ; exit $? ; }

cd /etc/openvpn || exit 1

[ "$(pgrep openvpn)" ] &&
    pkill -x openvpn

case "$1" in
    swi*|-ch) loc=Switzerland  ;;
    can*|-ca) loc=CA\ Montreal ;;
    sin*|-sg) loc=Singapore    ;;
    nor*|-no) loc=Norway       ;;
    fin*|-fl) loc=Finland      ;;
    jap*|-jp) loc=Japan        ;;
    rom*|-ro) loc=Romania      ;;
    *) loc="$(ls *.ovpn | sort -R | head -n 1)"
       loc="${loc%.*}"
esac

openvpn ./$loc.ovpn > /dev/null &

echo -n "$loc" > /tmp/vpn
