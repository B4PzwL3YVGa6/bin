#!/bin/dash
#
# http://github.com/MitchWeaver/bin
#

# ----- settings --------------- #
FILE="${HOME}/var/files/tasks"
PROMPT='Task'
# ------------------------------ #

# Import the colors
. "${HOME}/.cache/wal/colors.sh"

# ------------------------------------------------------- 
res="$(xrandr --nograb --current | awk '/\*/ {print $1}')"
res="${res% *}"
sw="${res%x*}"
sh="${res#*x}"
sw="${sw%.*}"
sh="${sh%.*}"

w=$((sw / 2)) # width
x=$((sw / 2 - w / 2)) # x-offset
y=$((sh / 5)) # y-offset
h=$((sh / 50)) # height
# ------------------------------------------------------- 

dmenu='dmenu -f -nb "$color0" -nf "$color15" -sb "$color2" -sf "$color15" -x $x -y $y -wi $w'

length=$(cat $FILE | wc -l)
action="cat $FILE | $dmenu -l $length -p '$PROMPT:' "
cmd="$(eval $action)"
while [ -n "$cmd" ]; do
	if [ "$(grep ^$cmd $FILE)" ]; then
		grep -v "^$cmd" "$FILE" > /tmp/todo
		mv /tmp/todo "$FILE"
        length=$((length - 1))
	else
		echo "$cmd" >> "$FILE"
        length=$((length + 1))
	fi
    action="cat $FILE | $dmenu -l '$length' -p '$PROMPT:' "
	cmd="$(eval $action)"
done
